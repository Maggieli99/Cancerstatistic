# Data transformation

```{r}
library(readr)
library(tidyverse)
library(tidyr)
library(dplyr)
```

All of our datasets generated from GBD results tool need to be pre-processed as they are not in a tidy format originally. Please go to our [github repo chapter](https://github.com/Maggieli99/Cancerstatistic/blob/main/03-cleaning.Rmd) to see code in detail.

## The Effect of Genetic Factors on Cancer

For the risk data, we first removed the used columns "location", "upper" and "lower". And then we pivoted our dataset so that the combinations of *measure* and *metric* became new columns (variables) in the wider tidy data and values in *val* were placed in the corresponding entries. We also updated the columns names of our new data frame so that these names are more precise. Finally, noticed that all of our columns of character type have limited number of categories, we transformed all character columns into factors.

```{r}
cancer_risk <- read_csv("./data/risk.csv")
```
```{r}
# clean and pivot dataset
cancer_risk <- cancer_risk %>% 
  select(-c('location', 'upper', 'lower')) %>%
  pivot_wider(names_from = c(measure, metric), values_from = val) 

names(cancer_risk)[c(4, 9:14)]<-c('risk', 'YLDs_Number', 'YLDs_Percent', 'YLDs_Rate',  'YLLs_Number', 'YLLs_Percent', 'YLLs_Rate')
```

```{r}
# make str columns factors
cancer_risk$sex <- factor(cancer_risk$sex)
cancer_risk$age <- factor(cancer_risk$age)
cancer_risk$cause <- factor(cancer_risk$cause)
cancer_risk$risk <- factor(cancer_risk$risk)
cancer_risk$year <- factor(cancer_risk$year)
```

After data cleaning and transformation, our *cancer_risk* data frame has much less rows and contains only meaningful variables.

```{r}
str(cancer_risk)
```

## question 2
```{r}
cancer = read.csv(file = 'cancer.csv',header = TRUE)
cancer = cancer %>%
  select(-c('sex','age','upper','lower','cause')) %>%
  filter(cancer$year != '2000')
cancer = filter(cancer,cancer$measure == 'Deaths')
cancer = filter(cancer, cancer$location != 'India')
cancer
country = read.csv(file = 'country.csv',header = TRUE)
country = country[which(country$Indicator.Code %in% c('NY.GNP.MKTP.PP.CD','NY.GDP.PCAP.KN')),]
country = country %>%
  select(c('Country.Name','Indicator.Name','X1990','X2019'))
country = country %>%
  gather(Year,Number,c(X1990,X2019))
country = country %>%
  spread(Indicator.Name,Number)
country = country %>% mutate(Year=recode(Year, 
                         'X1990'="1990",
                         'X2019'="2019"))
country
colnames(country) = c('country','year','GDP','GNI')
country$year = as.factor(country$year)
cancer$year = as.factor(cancer$year)
cancer$location = as.factor(cancer$location)
country$country = as.factor(country$country)
levels(cancer$location)[levels(cancer$location)=="United States of America"] <- "United States"
levels(cancer$location)[levels(cancer$location)=="Australasia"] <- "Australia"
levels(country$country)[levels(country$country)=="Congo, Rep."] <- "Congo"
data = full_join(cancer,country, by = c('location' = 'country','year' = 'year'))
data = data %>%
  spread(metric,val)
data
```



## question 3

For the making_progress data, we need to do the similar step with risk data, that is, we first removed the used columns "location", "upper" and "lower". And then we pivoted our dataset so that the combinations of *measure* and *metric* became new columns (variables) in the wider tidy data and values in *val* were placed in the corresponding entries. To be more precise and clear, we need to change the column name for the metric. Last but not least, we still need to transform all character columns into factors.

```{r}
cancer_making_progress <- read_csv("./data/making_progess.csv")
```

```{r}
library(ggplot2)
library(dplyr)
library(tidyverse)
library(tidyr)
library(highcharter)
# clean and pivot dataset
cancer_making_progress <- cancer_making_progress %>% 
  select(-c('location', 'upper', 'lower')) %>%
  pivot_wider(names_from = c(measure, metric), values_from = val) 

names(cancer_making_progress)[c(5, 7:9)]<-c('DALYs_Rate', 'YLLs_Rate', 'YLDs_Percent', 'YLDs_Rate')
```