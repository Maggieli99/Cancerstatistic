--- 
title: "Cancer Statistic"
author: "Yiquan Li, Chenxi Jiang, Zezhong Fan"
date: "`r Sys.Date()`"
site: bookdown::bookdown_site
---
```{r include=FALSE, cache=FALSE}
knitr::opts_chunk$set(
  echo = FALSE,
  message = FALSE,
  warning = FALSE
)
```

# Introduction

In today's era, the impact of cancer on society has even reached the point that when someone is talking about cancer, others' faces will take on a ghastly expression. Cancer seriously affects the emotional, physical, and mental state of patients. In the years after cancer patients are diagnosed, their quality of life will drastically decrease. For the physiological side effects of advanced cancer treatment, such as impaired fertility, sexual dysfunction, hair loss, and weight gain, patients will feel inferior or even will be discriminated against.
Especially for families with poor financial status, not only must they consider whether they can afford medical expenses, but also how to face and deal with the despair and fear of death of cancer patients. Therefore, family members of cancer patients are also under tremendous psychological pressure, and their physical and mental health is also affected. Sometimes some patients cannot effectively control cancer pain with drugs, which will have a great impact on the patient's quality of life and psychological pressure, including anxiety, despair, and fear. Therefore, understanding and coping with the emotional, mental and physical trauma of cancer to humans will maximize the quality of life of cancer patients and their families. Modern medicine has invested considerable human and material resources in cancer research for a long time, and has gradually understood and understood the causes of cancer; the diagnosis of cancer has made considerable progress due to advances in science and technology. In order to alleviate everyoneâ€™s anxiety about cancer, we would like to learn more about cancer in different aspects, and see whether the world has really made progress against cancer and by how much in this project. Specifically, we will combine different data visualization methods and frames to explore the deeply current situation of cancer around the world and the progress in the medical realm against cancer.

In this projeect, three questions that we would like to persue are as follows:

By how much is all kinds of cancer caused by genetic factors?
What is the relationship between cancer survival rate and level of development (population, GDP, income, inequality, and so on) of a country?
How does the world make propress against cancer over time?
The data souce we find includes data on many different aspect of cancer, including cancer prevalence, cancer mortality over time, causes of cancer and so on. From these data source, we can get the information that how cancer is relating to our world that it not only affects each family but also influence sundry countries. During this pandemic, the discussion one health problems should be on the agenda urgently. Via merging different tables, we can extract the data we need, and find the conclusion of our above cancer related questions.

Link to our book URL: https://maggieli99.github.io/Cancerstatistic.

This repo was initially generated from a bookdown template available here: https://github.com/jtr13/EDAVtemplate.

<!--chapter:end:index.Rmd-->

```{r include=FALSE, cache=FALSE}
knitr::opts_chunk$set(
  echo = FALSE,
  message = FALSE,
  warning = FALSE
)
```
# Data sources

```{r}
library(here)
```


The primary data source for this project is Global Health Data Exchange (GHDx) and [*World Bank*](https://data.worldbank.org/country). 

GHDx is a catalog of global health and demographic data. It provides statistics and other information about all kinds of diseases for different countries and for the globe as a whole. We use the [*GBD (Global Burden of Disease) Results Tool*](http://ghdx.healthdata.org/gbd-results-tool) built inside to generate our datasets about cancer in different aspects. The tool allows retrieval of GBD results and provides several variables for people to choose and combine. A brief introduction about the contents this tool supplies are as follows:

* __Base__: This menu provides 2 choices: *Single* means single year estimates, *Change* means multi-year estimates for select year ranges
* __Location__: This menu provides GBD super regions, regions, countries, subnational units, and custom regions (WHO regions, World Bank Income Levels, and more) to choose from
* __Year__: 1990-2019
* __Context__: This menu defines the type of indicator results people can access. It contains all GBD causes, risks, impairments, injuries by nature, etiology, etc. Once we select one of these results, a new drop-down menu about that result (varialbe) will appear and we can choose the values of our interest.
* __Age__: All GBD age groups
* __Metric(units)__: The choices are number, rate, and percent
* __Measure__: The choices are deaths, years of life lost (YLLs), years lived with disability (YLDs), disability-adjusted life years (DALYs), prevalence, incidence, life expectancy, healthy life expectancy (HALE), maternal mortality ratio (MMR), and summary exposure value (SEV)
* __Sex__: The choices are male, female, and both

If we generates the results for all measures for every single entry of the above menus, the dataset will be so huge and complicated since it contains data for countries all over the world for 30 years. So, to better conduct our analysis on several focuses, we generated three major datasets from GBD Results Tool and each group member was responsible for creating their dataset to solve corresponding questions. 

World Bank collects and provides large amount of global development data and was used as data supplement of countries' statistics in our dataset.

Details about the datasets are as follows:

## The Effect of Genetic Factors on Cancer

**Dataset: risk.csv**

The dataset is created from GBD Results Tool by choosing risk as context. 

```{r}
risk_desription <- readr::read_csv(here::here("./data/data_description.csv"))
knitr::kable(risk_desription[1:11, ], caption="Risk Data Desription", row.names=FALSE, font_size=10)
```

**Issues with this dataset: **

1. The column "location" only has one value "Global" so it is not a useful variable in the dataset. And the columns "upper" and "lower" give a boundaries to "val". In this project, we only used the "val" provided and not consider the range of "val". So, "upper" and "lower" columns were also not used. The unused columns need to be removed.

2. All the measures are assigned with three metrics: number, percent, and rate. Some metrics are not suitable to be used on some measures. For instance, percentage of years of life lost does not make much sense. So, we might consider deleting some meaningless or unused metrics to decrease data size.

3. The dataset is not tidy. Column "measure" actually contains the variables of our interests. And "val" stores the values of corresponding variable. This dataset needs to be pivot to a tidy format.


## question 2



## question 3

**Dataset: making_progress.csv**

The dataset is created from GBD Results Tool by choosing cause as context. 

```{r}
making_progress_description<- readr::read_csv(here::here("./data/data_description.csv"))
make_progress_description<- making_progress_description[c(1,2,3,4,5,7,8,9,10,11),]
knitr::kable(make_progress_description[1:10,], caption="Making_progress_description Data Desription", row.names=FALSE, font_size=10)
```
**Issues with this dataset: **

1. Same as our topic 1, the column "location" only has one value "Global" which cannot provide more information. And the columns "upper" and "lower" give a boundaries to "val". However, we only used the "val" provided and not consider the range of "val". Hence, the unused columns need to be removed.

2. Considering that the dataset size need to be reduced, we may delete some meaningless and confusing metrics.

3. Here are three different "measure" way in our dataset, which we need to do tidy work to make them readable and clear.

<!--chapter:end:02-data.Rmd-->

```{r include=FALSE, cache=FALSE}
knitr::opts_chunk$set(
  echo = FALSE,
  message = FALSE,
  warning = FALSE
)
```
# Data transformation

```{r}
library(readr)
library(tidyverse)
library(tidyr)
library(dplyr)
```

All of our datasets generated from GBD results tool need to be pre-processed as they are not in a tidy format originally. Please go to our [github repo chapter](https://github.com/Maggieli99/Cancerstatistic/blob/main/03-cleaning.Rmd) to see code in detail.

## The Effect of Genetic Factors on Cancer

For the risk data, we first removed the used columns "location", "upper" and "lower". And then we pivoted our dataset so that the combinations of *measure* and *metric* became new columns (variables) in the wider tidy data and values in *val* were placed in the corresponding entries. We also updated the columns names of our new data frame so that these names are more precise. Finally, noticed that all of our columns of character type have limited number of categories, we transformed all character columns into factors.

```{r}
cancer_risk <- read_csv("./data/risk.csv")
```
```{r}
# clean and pivot dataset
cancer_risk <- cancer_risk %>% 
  select(-c('location', 'upper', 'lower')) %>%
  pivot_wider(names_from = c(measure, metric), values_from = val) 

names(cancer_risk)[c(4, 9:14)]<-c('risk', 'YLDs_Number', 'YLDs_Percent', 'YLDs_Rate',  'YLLs_Number', 'YLLs_Percent', 'YLLs_Rate')
```

```{r}
# make str columns factors
cancer_risk$sex <- factor(cancer_risk$sex)
cancer_risk$age <- factor(cancer_risk$age)
cancer_risk$cause <- factor(cancer_risk$cause)
cancer_risk$risk <- factor(cancer_risk$risk)
cancer_risk$year <- factor(cancer_risk$year)
```

After data cleaning and transformation, our *cancer_risk* data frame has much less rows and contains only meaningful variables.

```{r}
str(cancer_risk)
```

## question 2
```{r}
cancer = read.csv(file = './data/final.csv',header = TRUE)
cancer = cancer %>%
  select(-c('sex','age','upper','lower','cause')) 

##filter(cancer$year != '2000')
cancer = filter(cancer,cancer$measure == 'Deaths')
##cancer = filter(cancer, cancer$location != 'India')
cancer
country = read.csv(file = './data/allCountry.csv',header = TRUE)
country
country = country[which(country$Indicator.Code %in% c('NY.GNP.MKTP.PP.CD','NY.GDP.PCAP.PP.CD','SH.XPD.CHEX.PC.CD','SH.XPD.CHEX.GD.ZS')),]
country
country = country %>%
  select(c('Country.Name','Indicator.Name','X1990','X1995','X2000','X2005','X2010','X2015','X2019'))
country
country = country %>%
  gather(Year,Number,c(X1990,X1995,X2000,X2005,X2010,X2015,X2019))
country = country %>%
  spread(Indicator.Name,Number)

country = country %>% mutate(Year=recode(Year, 
                         'X1990'="1990",
                         'X1995'="1995",'X2000'="2000",'X2005'="2005",'X2010'="2010",'X2015'="2015",'X2019'="2019"))
country
colnames(country) = c('country','year','Health_Cost_of_GDP','Health_Cost','GDP','GNI')
country$year = as.factor(country$year)
cancer$year = as.factor(cancer$year)
cancer$location = as.factor(cancer$location)
country$country = as.factor(country$country)
levels(cancer$location)[levels(cancer$location)=="United States of America"] <- "United States of America"
levels(country$country)[levels(country$country)=="United States"] <- "United States of America"
levels(cancer$location)[levels(cancer$location)=="Australasia"] <- "Australia"
levels(country$country)[levels(country$country)=="Egypt, Arab Rep."] <- "Egypt"
levels(country$country)[levels(country$country)=="Congo, Rep."] <- "Congo"
levels(country$country)[levels(country$country)=="Iran, Islamic Rep."] <- "Iran"
levels(cancer$location)[levels(cancer$location)=="Iran (Islamic Republic of)"] <- "Iran"
data = full_join(cancer,country, by = c('location' = 'country','year' = 'year'))
data = data %>%
  spread(metric,val)
data = data[-c(1)]
data$year  = as.character(data$year)
cat(NULL,file="./data/finalData.csv")
write_csv(data,'./data/finalData.csv')

cancer = read.csv(file = './data/finalData.csv',header = TRUE)
cancer = cancer %>% select(c(year,Rate,location)) %>%
  spread(year,Rate)
cat(NULL,file="./data/interactive.csv")
write_csv(cancer,'./data/interactive.csv')


```



## question 3

For the making_progress data, we need to do the similar step with risk data, that is, we first removed the used columns "location", "upper" and "lower". And then we pivoted our dataset so that the combinations of *measure* and *metric* became new columns (variables) in the wider tidy data and values in *val* were placed in the corresponding entries. To be more precise and clear, we need to change the column name for the metric. Last but not least, we still need to transform all character columns into factors.

```{r}
cancer_making_progress <- read_csv("./data/making_progess.csv")
```

```{r}
library(ggplot2)
library(dplyr)
library(tidyverse)
library(tidyr)
library(highcharter)
# clean and pivot dataset
cancer_making_progress <- cancer_making_progress %>% 
  select(-c('location', 'upper', 'lower')) %>%
  pivot_wider(names_from = c(measure, metric), values_from = val) 

names(cancer_making_progress)[c(5, 7:9)]<-c('DALYs_Rate', 'YLLs_Rate', 'YLDs_Percent', 'YLDs_Rate')
```

<!--chapter:end:03-cleaning.Rmd-->

```{r include=FALSE, cache=FALSE}
knitr::opts_chunk$set(
  echo = FALSE,
  message = FALSE,
  warning = FALSE
)
```
# Missing values

## question 1

```{r}
library(readr)
library(tidyverse)
library(tidyr)
library(dplyr)
library(ggplot2)
library(patchwork)
```

```{r}
plot_missing <- function(df, percent=FALSE) {
  missing_patterns <- data.frame(is.na(df)) %>%
  group_by_all() %>%
  count(name = "count", sort = TRUE) %>%
  ungroup()
  
  pure_pattern <- missing_patterns[,-which(names(missing_patterns) == "count")]
  pure_pattern$incomplete <- as.logical(rowSums(pure_pattern))
  missing_patterns$incomplete <- pure_pattern$incomplete

  tidymissing <- missing_patterns %>% 
    rownames_to_column() %>%
    gather(key, value, -c(count, rowname, incomplete))
  
  tidymissing$rowname <- as.factor(as.numeric(tidymissing$rowname))

  main_plot <- ggplot(tidymissing, aes(x=fct_reorder(key,-value*count, sum),y=fct_rev(rowname),fill=value, alpha=incomplete)) +
    geom_tile(color="white") + theme_classic() +
    scale_fill_discrete(type=c("grey", "purple")) +
    scale_alpha_manual(values = c(1,0.5)) +
    annotate("text", x = length(unique(tidymissing$key))/2+0.5, y = which(rev(pure_pattern$incomplete)==FALSE), label="complete cases") + 
    xlab('variable') +
    ylab('missing pattern') + 
    theme(legend.position = "none")
  
  missing_by_pattern <- missing_patterns %>%
  select(count, incomplete) %>%
  rownames_to_column() 
  
  missing_by_pattern$rowname <- as.factor(as.numeric(missing_by_pattern$rowname))
  missing_by_pattern$percentage <- missing_by_pattern$count/sum(missing_by_pattern$count)*100
  
  missing_by_pattern$plotby <- missing_by_pattern$count 
  y_lab_pattern = "row count"
  if (percent==TRUE) {
    missing_by_pattern$plotby <- missing_by_pattern$percentage
    y_lab_pattern = "% rows"
  }

  pattern_bar <- ggplot(missing_by_pattern, aes(x=fct_rev(rowname), y=plotby, alpha=incomplete)) + 
    geom_bar(stat="identity",fill="blue") + 
    scale_alpha_manual(values = c(1,0.5)) +
    coord_flip() +
    ylab(y_lab_pattern) +
    theme(panel.background = element_rect(fill = NA), axis.title.y = element_blank(), panel.grid.major.y = element_blank(), 
          panel.grid.major.x = element_line(colour="grey"), panel.grid.minor.x = element_line(colour="grey"), panel.grid.minor.y = element_blank(),
          panel.border = element_rect(fill = NA), legend.position = "none")
  
  temp_df = apply(data.frame(is.na(df)),2,sum)
  ylabel = "num rows\n missing:"
  if (percent==TRUE) {
    temp_df = apply(data.frame(is.na(df)),2,mean)*100
    ylabel = "% rows\n missing:"
  }
  
  missing_by_col <- data.frame(temp_df) %>% 
    rownames_to_column() %>%
    filter(rowname!='incomplete')

  colnames(missing_by_col) <- c('key', 'pattern_count')

  col_bar <- ggplot(missing_by_col, aes(x=fct_reorder(key, -pattern_count), y = pattern_count))+geom_bar(stat="identity",fill="lightblue") +
    ylab(ylabel) +
    theme(panel.background = element_rect(fill = NA), axis.title.x = element_blank(), panel.grid.major.x = element_blank(), 
          panel.grid.major.y = element_line(colour="grey"), panel.grid.minor.x = element_blank(),panel.border = element_rect(fill = NA)) +
    ggtitle("Missing value patterns")
  
  if (percent==TRUE) {
    pattern_bar <- pattern_bar + ylim(0, 100)
    col_bar <- col_bar + ylim(0, 100)
  }
  
  col_bar + (ggplot()+theme_void())+ main_plot + pattern_bar + plot_layout(ncol=2, widths=c(4,1), heights=c(1,3))
}
```

The original risk data frame does not have any missing values since GBD Results Tool has already ignored all the observations with missing value. So I get another smaller dataset to get another perspective of missing value.

```{r}
names(cancer_risk)<-abbreviate(names(cancer_risk), minlength = 4)
plot_missing(cancer_risk)
```

So I get another smaller dataset to get another perspective of missing value and the dataset is as follows:

```{r}
cancerdata <- read_csv("cancerdata.csv")
head(cancerdata)
```

Our original dataset is downloaded from the source https://ghdx.healthdata.org/. It shows the information about in the global scale in 2019, the death rates of each kind of cancer caused by different external risks for all ages. We can see that the dataset is not in a tidy format. There are many useless variables that only contains one value. So below we transformed the data into a tidy format using only the variables of our interests.


```{r}
newdata <- cancerdata[,c("cause", "rei", "val")]
names(newdata) <- c("type", "risk", "death_rate")

tidydata <- newdata %>%
  pivot_wider(names_from = risk, values_from = death_rate) %>%
  column_to_rownames(var="type")
head(tidydata)
```
After transformation, we get a new data frame. Each observation is the death rates of one kind of cancer caused by different external risks. There is a lot of missing values in our dataset because not all types of cancer are related to all kinds of risks. For example, some types of cancer may be induced by air pollution, but will not be induced by alcohol use. 

In order to see the relationship between cancer types and external risks, we analyze the missing values in this data frame below.

```{r}
plot_missing <- function(df, percent=FALSE) {
  missing_patterns <- data.frame(is.na(df)) %>%
  group_by_all() %>%
  count(name = "count", sort = TRUE) %>%
  ungroup()
  
  pure_pattern <- missing_patterns[,-which(names(missing_patterns) == "count")]
  pure_pattern$incomplete <- as.logical(rowSums(pure_pattern))
  missing_patterns$incomplete <- pure_pattern$incomplete

  tidymissing <- missing_patterns %>% 
    rownames_to_column() %>%
    gather(key, value, -c(count, rowname, incomplete))
  
  tidymissing$rowname <- as.factor(as.numeric(tidymissing$rowname))

  main_plot <- ggplot(tidymissing, aes(x=fct_reorder(key,-value*count, sum),y=fct_rev(rowname),fill=value, alpha=incomplete)) +
    geom_tile(color="white") + theme_classic() +
    scale_fill_discrete(type=c("grey", "purple")) +
    scale_alpha_manual(values = c(1,0.5)) +
    annotate("text", x = length(unique(tidymissing$key))/2+0.5, y = which(rev(pure_pattern$incomplete)==FALSE), label="complete cases") + 
    xlab('variable') +
    ylab('missing pattern') + 
    theme(legend.position = "none")
  
  missing_by_pattern <- missing_patterns %>%
  select(count, incomplete) %>%
  rownames_to_column() 
  
  missing_by_pattern$rowname <- as.factor(as.numeric(missing_by_pattern$rowname))
  missing_by_pattern$percentage <- missing_by_pattern$count/sum(missing_by_pattern$count)*100
  
  missing_by_pattern$plotby <- missing_by_pattern$count 
  y_lab_pattern = "row count"
  if (percent==TRUE) {
    missing_by_pattern$plotby <- missing_by_pattern$percentage
    y_lab_pattern = "% rows"
  }

  pattern_bar <- ggplot(missing_by_pattern, aes(x=fct_rev(rowname), y=plotby, alpha=incomplete)) + 
    geom_bar(stat="identity",fill="blue") + 
    scale_alpha_manual(values = c(1,0.5)) +
    coord_flip() +
    ylab(y_lab_pattern) +
    theme(panel.background = element_rect(fill = NA), axis.title.y = element_blank(), panel.grid.major.y = element_blank(), 
          panel.grid.major.x = element_line(colour="grey"), panel.grid.minor.x = element_line(colour="grey"), panel.grid.minor.y = element_blank(),
          panel.border = element_rect(fill = NA), legend.position = "none")
  
  temp_df = apply(data.frame(is.na(df)),2,sum)
  ylabel = "num rows\n missing:"
  if (percent==TRUE) {
    temp_df = apply(data.frame(is.na(df)),2,mean)*100
    ylabel = "% rows\n missing:"
  }
  
  missing_by_col <- data.frame(temp_df) %>% 
    rownames_to_column() %>%
    filter(rowname!='incomplete')

  colnames(missing_by_col) <- c('key', 'pattern_count')

  col_bar <- ggplot(missing_by_col, aes(x=fct_reorder(key, -pattern_count), y = pattern_count))+geom_bar(stat="identity",fill="lightblue") +
    ylab(ylabel) +
    theme(panel.background = element_rect(fill = NA), axis.title.x = element_blank(), panel.grid.major.x = element_blank(), 
          panel.grid.major.y = element_line(colour="grey"), panel.grid.minor.x = element_blank(),panel.border = element_rect(fill = NA)) +
    ggtitle("Missing value patterns")
  
  if (percent==TRUE) {
    pattern_bar <- pattern_bar + ylim(0, 100)
    col_bar <- col_bar + ylim(0, 100)
  }
  
  col_bar + (ggplot()+theme_void())+ main_plot + pattern_bar + plot_layout(ncol=2, widths=c(4,1), heights=c(1,3))
}
```

```{r}
names(tidydata)<-abbreviate(names(tidydata), minlength = 6)
plot_missing(tidydata)
```

From the missing pattern plot we can see that for each of the risks air pollution, drug use, other environmental risks, unsafe sex and low physical activity, their values are missing for all other types of cancer except one. That means theses risks are highly correlated to one specific kind of cancer and people need to be care of those risks if they would like to avoid the specific types of cancer. 

We can also see that if data is missing for risk air pollution, then it is likely to be missing in for other environmental risks. It makes sense since air pollution is also one kind of environmental risk. It is chosen to be a separated variable because it accounts for a large proportion of environmental risks.

Another thing of our notice is that risk tobacco is almost not missing for all kinds of cancer, which means it can be the induction of the majority types of cancer. So in order to protect ourselves from being attacked by cancer, we should try to avoid use tobacco a lot.

We do not have a complete case here because no type of cancer would be induced by all the external risks.

Below, by explicitly drawing missing values in each observation, we can have a better understanding of similarities in different kinds of cancer.

```{r}
tidycancer <- tidydata %>%
  rownames_to_column("type") %>%
  gather(key, value, -type) %>%
  mutate(missing = ifelse(is.na(value), 1, 0)) %>%
  group_by(key) %>%
  mutate(Std = ifelse(value-mean(value, na.rm = TRUE)==0, 0, (value-mean(value, na.rm = TRUE))/sd(value, na.rm=TRUE))) %>% 
  ungroup()

ggplot(tidycancer, aes(x=fct_reorder(key, -missing, sum), y=fct_reorder(type, -missing, sum), fill=Std)) +
  geom_tile(color="white") +
  scale_fill_gradient2(low="blue", mid="white", high = "yellow", na.value = "black") + 
  xlab("type of cancer") +
  ylab("risk") +
  theme_bw()
```

From the plot above, tracheal, bronchus, and lung cancer is affected by external risks the most since it can be induced by majority of the risks listed. It also has the highest death rate because we can see many of the blocks are yellow which means the rate is very high.

Uterine cancer, thyroid cancer and gallbladder and biliary tract cancer have the same missing pattern. Colon and rectum cancer and breast cancer have same missing pattern. It suggests that there might be some similarity in these kinds of cancer, though not obvious now, but may help people find treatment to these types of cancer.

Nasopharynx cancer and larynx cancer have same missing pattern. Other pharynx cancer and lip and oral cavity cancer have same missing pattern. And these two missing patterns are also similar to each other. It makes sense since they are all related to throat.


## question 2

## question 3

<!--chapter:end:04-missing.Rmd-->

```{r include=FALSE, cache=FALSE}
knitr::opts_chunk$set(
  echo = FALSE,
  message = FALSE,
  warning = FALSE
)
```
# Results

## question 1

## question 2
```{r}
library(ggplot2)
library(dplyr)
library(tidyverse)
library(tidyr)
library(highcharter)
library(plotly)
library(ggpubr)
```

```{r}
data = read_csv(file = './data/finalData.csv')
new_data = data %>% 
  group_by(location) %>%
  do(item = list(country = first(.$location),sequence = .$Rate), value = first(.$Rate))%>%
    .$item

highchart(type = 'map') %>%
  hc_add_series(data =  new_data,joinBy = c('name','country'),mapData = worldgeojson,  dataLabels = list(enabled = TRUE, format = "{point.properties.postalcode}"))  %>%
  hc_colorAxis(stops = color_stops(n = 3, colors = c("firebrick2","white","dodgerblue3")))  %>%

  hc_motion(enabled = TRUE,
    axisLabel = "year",labels =as.character(sort(unique(data$year),decreasing = FALSE)),
    magnet = list(
      round = "floor" 
    ))%>% 
  hc_legend(layout = "vertical", 
            align = "right",
            title = list(text = 'Death Rate')) %>%
  hc_add_theme(hc_theme_smpl()) %>%
  hc_exporting(enabled = TRUE)  %>%
  hc_title(text = "Death Rate In The World From 1990 To 2019")

```
```{r}
new_data = data[-which(data$location=='Brazil'),]
new_data
new_data = new_data[new_data$year %in% c('2000','2005','2010','2015'),]
x2000 = new_data[new_data$year=='2000',]
x2005 = new_data[new_data$year=='2005',]
x2010 = new_data[new_data$year=='2010',]
x2015 = new_data[new_data$year=='2015',]
```
```{r}
new_data
fig <- new_data %>%
  plot_ly(
    x = ~Health_Cost_of_GDP, 
    y = ~Rate, 
    size = ~GDP, 
    color = ~Rate,
    frame = ~year, 
    text = ~location, 
    hoverinfo = "text",
    type = 'scatter',
    mode = 'markers'
  )%>% animation_opts(
    1000, easing = "elastic", redraw = FALSE
  )
fig
```
```{r}
library(RColorBrewer)
COLORS <- RColorBrewer::brewer.pal(6, "Set2")
try_data = new_data[-which(new_data$location=='China'),]
try_data %>%
  hchart('column',hcaes(x = 'location', y = 'Number',group = 'year'),stacking="year") %>%
  hc_legend(title = list(text = "Year",style=list(fontSize='10px')),
            align = "right", verticalAlign = "middle",layout = "vertical",floating=FALSE) %>%
  hc_colors(COLORS)%>%
  hc_chart(zoomType = "x") %>%
  hc_xAxis(title = list(text = "Country")) %>%
  hc_yAxis(title = list(text = 'Accumulated Death'))  %>%
  hc_subtitle(text = "Click on the legend to show selected years") %>%
  hc_exporting(enabled = TRUE)
```
```{r}
new_data  =  data %>%
  mutate(scaled_GDP = GDP/100)

new_data = new_data[-which(new_data$location=='Brazil'),]
new_data = new_data[new_data$year %in% c('2000','2005','2010','2015'),]
x2000 = new_data[new_data$year=='2000',]
x2005 = new_data[new_data$year=='2005',]
x2010 = new_data[new_data$year=='2010',]
x2015 = new_data[new_data$year=='2015',]
x2000
plot_2000 = ggplot(data = x2000,aes(x = scaled_GDP, y = Rate))+geom_line(colour="#FF9999")+geom_point(colour="#FF9999")+ggtitle("Death Rate by GDP in 2000") +
  labs(x ="GDP", y ="Death Rate")+
  theme_grey(10)+
  theme(plot.title =element_text(face='bold', color ='steelblue2'))

plot_2005 = ggplot(data = x2005,aes(x = scaled_GDP, y = Rate))+geom_line( colour="#E69F00")+geom_point(colour="#E69F00")+ggtitle("Death Rate by GDP in 2005") +
  labs(x ="GDP", y ="Death Rate")+
  theme(plot.title =element_text(face='bold', color ='steelblue2'))

plot_2010= ggplot(data = x2010,aes(x = scaled_GDP, y = Rate))+geom_line(colour="#F0E442")+geom_point(colour="#F0E442")+ggtitle("Death Rate by GDP in 2010") +
  labs(x ="GDP", y ="Death Rate")+
  theme(plot.title =element_text(face='bold', color ='steelblue2'))

plot_2015 = ggplot(data = x2015,aes(x = scaled_GDP, y = Rate))+geom_line(colour="#CC79A7")+geom_point(colour="#CC79A7")+ggtitle("Death Rate by GDP in 2015") +
  labs(x ="GDP", y ="Death Rate")+
  theme(plot.title =element_text(face='bold', color ='steelblue2'))

ggarrange(plot_2000,plot_2005,plot_2010,plot_2015, 
          label.y = 1,
          align='hv',
          ncol = 1, nrow = 4)
```

## question 3

<!--chapter:end:05-results.Rmd-->

```{r include=FALSE, cache=FALSE}
knitr::opts_chunk$set(
  echo = FALSE,
  message = FALSE,
  warning = FALSE
)
```
# Interactive component



<!--chapter:end:06-interactive.Rmd-->

```{r include=FALSE, cache=FALSE}
knitr::opts_chunk$set(
  echo = FALSE,
  message = FALSE,
  warning = FALSE
)
```
# Conclusion


<!--chapter:end:07-conclusion.Rmd-->

